"use strict";const SCRIPT_START=Date.now(),MS_PER_SECOND=1e3,MS_PER_MINUTE=6e4,MS_PER_HOUR=36e5,SECONDS_PER_HOUR=3600,KMS_PER_MI=1.609344,API_FETCH_TIMEOUT=1e4,DEFERRAL_TIMEOUT=15e3,SPEED_INTERVAL=1e3,CACHE_TTL=36e5,API_KEY_LENGTH=16,SELECTORS=Object.freeze({links_container:"#racing-leaderboard-header-root div[class^='linksContainer']",main_container:"#racingMainContainer",additional_container:"#racingAdditionalContainer",drivers_title:"#racingupdates .drivers-list div[class^='title']",drivers_leaderboard:"#racingupdates .drivers-list #leaderBoard"}),LOG_LEVEL=Object.freeze({debug:10,info:20,warn:30,error:40,silent:50}),LOG_MODE=LOG_LEVEL.debug;class Logger{static get time(){const e=Date.now()-SCRIPT_START;return e>0?` ${e} msec`:""}static debug(...e){LOG_MODE>LOG_LEVEL.debug||console.log("%c[DEBUG][TornPDA.Racing+]: ","color:#6aa84f;font-weight:600",...e,this.time)}static info(...e){LOG_MODE>LOG_LEVEL.info||console.log("%c[INFO][TornPDA.Racing+]: ","color:#3d85c6;font-weight:600",...e,this.time)}static warn(...e){LOG_MODE>LOG_LEVEL.warn||console.log("%c[WARN][TornPDA.Racing+]: ","color:#e69138;font-weight:600",...e)}static error(...e){LOG_MODE>LOG_LEVEL.error||console.log("%c[ERROR][TornPDA.Racing+]: ","color:#d93025;font-weight:600",...e)}}"function"!=typeof Date.unix&&Object.defineProperty(Date,"unix",{value:()=>Math.floor(Date.now()/1e3),writable:!0,configurable:!0,enumerable:!1}),"function"!=typeof Number.formatDate&&Object.defineProperty(Number,"formatDate",{value:e=>{const r=new Date(e);return`${String(r.getFullYear())}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`},writable:!0,configurable:!0,enumerable:!1}),"function"!=typeof Number.formatTime&&Object.defineProperty(Number,"formatTime",{value:e=>{const r=Math.floor(e%36e5/6e4),a=Math.floor(e%6e4/1e3),t=Math.floor(e%1e3);return`${String(r).padStart(2,"0")}:${String(a).padStart(2,"0")}.${String(t).padStart(3,"0")}`},writable:!0,configurable:!0,enumerable:!1}),"function"!=typeof Number.isValid&&Object.defineProperty(Number,"isValid",{value:e=>"number"==typeof e&&Number.isFinite(e),writable:!0,configurable:!0,enumerable:!1}),"function"!=typeof Error.prototype.toString&&Object.defineProperty(Error.prototype,"toString",{value:function(){const e=this&&this.name?String(this.name):"Error",r=this&&this.message?String(this.message):"";return r?`${e}: ${r}`:e},writable:!0,configurable:!0,enumerable:!1});class Store{static getValue=e=>localStorage.getItem(e);static setValue=(e,r)=>localStorage.setItem(e,r);static deleteValue=e=>localStorage.removeItem(e);static deleteAll=()=>localStorage.clear();static listValues=()=>Object.values(localStorage);static keys=Object.freeze({rplus_apikey:"RACINGPLUS_APIKEY",rplus_units:"RACINGPLUS_DISPLAYUNITS",rplus_addlinks:"RACINGPLUS_ADDPROFILELINKS",rplus_showskill:"RACINGPLUS_SHOWRACINGSKILL",rplus_showspeed:"RACINGPLUS_SHOWCARSPEED",rplus_showracelink:"RACINGPLUS_SHOWRACELINK",rplus_showexportlink:"RACINGPLUS_SHOWEXPORTLINK",rplus_showwinrate:"RACINGPLUS_SHOWCARWINRATE",rplus_showparts:"RACINGPLUS_SHOWCARPARTS",rplus_driver:"RACINGPLUS_DRIVER"})}class Distance{constructor(e={}){const{miles:r,kilometers:a}=e;if(null==r&&null==a)throw new TypeError("One of miles or kilometers must be specified.");const t=r??(null!=a?a/1.609344:0);if(!Number.isValid(t))throw new TypeError("Miles or Kilometers must be a number.");this._mi=t,this._units=null!=a?"km":"mi"}get mi(){return this._mi}get km(){return 1.609344*this._mi}toString(){return`${("km"===this._units?this.km:this.mi).toFixed(2)} ${this._units}`}}class Speed{constructor(e={}){const{distance:r,seconds:a}=e;if(!(r instanceof Distance))throw new TypeError("distance must be a Distance instance.");if(!Number.isInteger(a)||a<=0)throw new TypeError("seconds must be an integer > 0.");this._mph=r.mi/(a/3600),this._units=Store.getValue(Store.keys.rplus_units)??"mph"}get mph(){return this._mph}get kph(){return 1.609344*this._mph}toString(){return`${("kph"===this._units?this.kph:this.mph).toFixed(2)} ${this._units}`}}const RACE_COLOURS=["#5D9CEC","#48CFAD","#FFCE54","#ED5565","#EC87C0","#AC92EC","#FC6E51","#A0D468","#4FC1E9"],RACE_TRACKS={6:{name:"Uptown",distance:new Distance({miles:2.25}),laps:7},7:{name:"Withdrawal",distance:new Distance({miles:3.4}),laps:5},8:{name:"Underdog",distance:new Distance({miles:1.73}),laps:9},9:{name:"Parkland",distance:new Distance({miles:3.43}),laps:5},10:{name:"Docks",distance:new Distance({miles:3.81}),laps:5},11:{name:"Commerce",distance:new Distance({miles:1.09}),laps:15},12:{name:"Two Islands",distance:new Distance({miles:2.71}),laps:6},15:{name:"Industrial",distance:new Distance({miles:1.35}),laps:12},16:{name:"Vector",distance:new Distance({miles:1.16}),laps:14},17:{name:"Mudpit",distance:new Distance({miles:1.06}),laps:15},18:{name:"Hammerhead",distance:new Distance({miles:1.16}),laps:14},19:{name:"Sewage",distance:new Distance({miles:1.5}),laps:11},20:{name:"Meltdown",distance:new Distance({miles:1.2}),laps:13},21:{name:"Speedway",distance:new Distance({miles:.9}),laps:18},23:{name:"Stone Park",distance:new Distance({miles:2.08}),laps:8},24:{name:"Convict",distance:new Distance({miles:1.64}),laps:10}},PART_CATEGORIES={Aerodynamics:["Spoiler","Engine Cooling","Brake Cooling","Front Diffuser","Rear Diffuser"],Brakes:["Pads","Discs","Fluid","Brake Accessory","Brake Control","Callipers"],Engine:["Gasket","Engine Porting","Engine Cleaning","Fuel Pump","Camshaft","Turbo","Pistons","Computer","Intercooler"],Exhaust:["Exhaust","Air Filter","Manifold"],Fuel:["Fuel"],Safety:["Overalls","Helmet","Fire Extinguisher","Safety Accessory","Roll cage","Cut-off","Seat"],Suspension:["Springs","Front Bushes","Rear Bushes","Upper Front Brace","Lower Front Brace","Rear Brace","Front Tie Rods","Rear Control Arms"],Transmission:["Shifting","Differential","Clutch","Flywheel","Gearbox"],"Weight Reduction":["Strip out","Steering wheel","Interior","Windows","Roof","Boot","Hood"],"Wheels & Tires":["Tyres","Wheels"]};let torn_api,this_driver,this_race,page_observer;const API_COMMENT="RacingPlus",API_VALID_ROOTS=Object.freeze(["user","faction","market","racing","forum","property","key","torn"]),ACCESS_LEVEL=Object.freeze({Public:0,Minimal:1,Limited:2,Full:3});class TornAPI{constructor(e=null){this.cache=new Map,this.key=e}async request(e,r,a={}){if(!API_VALID_ROOTS.includes(e))throw new Error(`Invalid API root. Must be one of: ${API_VALID_ROOTS.join(", ")}`);if("string"!=typeof r)throw new Error("Invalid path. Must be a string.");let t="";if(!(null!=a&&"object"==typeof a&&Object.entries(a).length>0))throw new Error("Invalid argument. Params must be an object.");t=Object.entries(a).map(([e,r])=>`${encodeURIComponent(e)}=${encodeURIComponent(r)}`).join("&");const i=`https://api.torn.com/v2/${e}/${r.replace(/^\/+|\/+$/g,"")}?comment=${API_COMMENT}${this.key?`&key=${this.key}`:""}${t?`&${t}`:""}`,n=this.cache.get(i);if(n&&Date.now()-n.timestamp<36e5)return n.data;const s=new AbortController,o=setTimeout(()=>s.abort(),1e4);try{const e=await fetch(i,{signal:s.signal});if(!e.ok)throw new Error(`HTTP ${e.status} ${e.statusText||""}`.trim());const r=await e.json().catch(e=>{throw new Error(`Invalid JSON response: ${e}`)});if(!r||r.error)throw new Error(`API request failed: ${r?.error?.error??"Unknown error."}`);return this.cache.set(i,{data:r,timestamp:Date.now()}),r}catch(e){throw Logger.warn(`API request failed: ${e}`),e}finally{clearTimeout(o)}}async validate(e){if(!e||"string"!=typeof e||16!==e.length)throw new Error("Invalid API key: local validation.");const r=this.key;this.key=e;const a=await this.request("key","info",{timestamp:`${Date.unix()}`});if(a?.info?.access&&Number(a.info.access.level)>=ACCESS_LEVEL.Minimal)return Logger.debug("Valid API key."),!0;throw this.key=r,new Error("Invalid API key: unexpected response.")}}class TornDriver{constructor(e){this.id=e,this.skill=0,this.records={},this.cars={}}load(){const e=Store.getValue(Store.keys.rplus_driver);if(e)try{const r=JSON.parse(e);r&&r.id===this.id&&(this.skill=Number(r.skill)||0,this.records=r.records||{},this.cars=r.cars||{})}catch(e){Logger.warn(`Failed to load driver cache.\n${e}`)}}save(){const e=JSON.stringify({id:this.id,skill:this.skill,records:this.records,cars:this.cars});Store.setValue(Store.keys.rplus_driver,e)}updateSkill(e){const r=Number(e);Number.isValid(r)&&(this.skill=Math.max(this.skill,r),this.save())}async updateRecords(){try{if(!torn_api||!torn_api.key)throw new Error("TornAPI not initialized.");const e=await torn_api.request("user/racingrecords",{timestamp:`${Date.unix()}`});Array.isArray(e?.racingrecords)?(e.racingrecords.forEach(({track:e,records:r})=>{e?.id&&Array.isArray(r)&&(this.records[e.id]=r.reduce((e,r)=>(e[r.car_id]?(e[r.car_id].lap_time=Math.min(e[r.car_id].lap_time,r.lap_time),e[r.car_id].count+=1):e[r.car_id]={name:r.car_name,lap_time:r.lap_time,count:1},e),{}))}),this.save()):Logger.debug("Racing records response missing 'racingrecords' array.")}catch(e){Logger.warn(`Racing records fetch failed.\n${e}`)}}async updateCars(){try{if(!torn_api||!torn_api.key)throw new Error("TornAPI not initialized.");const e=await torn_api.request("user/enlistedcars",{timestamp:`${Date.unix()}`});Array.isArray(e?.enlistedcars)?(this.cars=e.enlistedcars.filter(e=>!e.is_removed).reduce((e,r)=>(e[r.car_item_id]={name:r.car_item_name,top_speed:r.top_speed,acceleration:r.acceleration,braking:r.braking,handling:r.handling,safety:r.safety,dirt:r.dirt,tarmac:r.tarmac,class:r.car_class,worth:r.worth,points_spent:r.points_spent,races_entered:r.races_entered,races_won:r.races_won,win_rate:r.races_entered>0?r.races_won/r.races_entered:0},e),{}),this.save()):Logger.debug("Enlisted cars response missing 'enlistedcars' array.")}catch(e){Logger.warn(`Enlisted cars fetch failed.\n${e}`)}}}(async e=>{Logger.info(`Application loading... ${new Date(SCRIPT_START).toISOString()}`);const r="###PDA-APIKEY###",a=!r.includes("###")&&void 0!==e.flutter_inappwebview&&"function"==typeof e.flutter_inappwebview.callHandler,t=r=>new Promise((a,t)=>{const i=e.document.querySelector(r);if(i)return a(i);let n;const s=setTimeout(()=>{o(),t(new Error(`deferral timed out: '${r}'`))},15e3),o=()=>{clearTimeout(s),n?.disconnect()};n=new MutationObserver(()=>{const t=e.document.querySelector(r);t&&(o(),a(t))}),n.observe(e.document.documentElement||e.document,{childList:!0,subtree:!0})}),i=r=>{const a=e.document.createElement("div");r.id&&(a.id=r.id),r.name&&a.setAttribute("name",r.name),r.className&&(a.className=r.className),r.style&&a.setAttribute("style",r.style),r.title&&(a.title=r.title);const t=e=>{null!=e&&("string"==typeof e?a.insertAdjacentHTML("beforeend",e):e instanceof Node&&a.appendChild(e))},i=r.innerHTML;return Array.isArray(i)?i.forEach(t):t(i),a},n=e=>`<label for="${e.id}">${e.label}</label><div><input type="checkbox" id="${e.id}" /></div>`,s=async r=>{if(Logger.debug("Adding settings panel..."),e.document.querySelector(".racing-plus-panel"))return;const t=i({class:"racing-plus-panel"});t.appendChild(i({class:"racing-plus-header",text:"Racing+"}));const s=i({class:"nowrap",html:[a?"":'<span class="racing-plus-apikey-actions"><button type="button" class="racing-plus-apikey-save" aria-label="Save"><svg xmlns="http://www.w3.org/2000/svg" viewBox="2 2 20 20" version="1.1"><path fill-rule="evenodd" clip-rule="evenodd" d="M7 2C4.23858 2 2 4.23858 2 7V17C2 19.7614 4.23858 22 7 22H17C19.7614 22 22 19.7614 22 17V8.82843C22 8.03278 21.6839 7.26972 21.1213 6.70711L17.2929 2.87868C16.7303 2.31607 15.9672 2 15.1716 2H7ZM7 4C6.44772 4 6 4.44772 6 5V7C6 7.55228 6.44772 8 7 8H15C15.5523 8 16 7.55228 16 7V5C16 4.44772 15.5523 4 15 4H7ZM12 17C13.6569 17 15 15.6569 15 14C15 12.3431 13.6569 11 12 11C10.3431 11 9 12.3431 9 14C9 15.6569 10.3431 17 12 17Z" /></svg></button><button type="button" class="racing-plus-apikey-reset" aria-label="Reset"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" version="1.1"><path d="M790.2 590.67l105.978 32.29C847.364 783.876 697.86 901 521 901c-216.496 0-392-175.504-392-392s175.504-392 392-392c108.502 0 206.708 44.083 277.685 115.315l-76.64 76.64C670.99 257.13 599.997 225 521.5 225 366.032 225 240 351.032 240 506.5 240 661.968 366.032 788 521.5 788c126.148 0 232.916-82.978 268.7-197.33z"/><path d="M855.58 173.003L650.426 363.491l228.569 32.285z"/></svg></button></span>','<input type="text" id="rplus-apikey" maxlength="16" />']}),o=i({class:"flex-col",html:[s,'<span class="racing-plus-apikey-status"></span>']}),l=i({class:"racing-plus-main"});l.appendChild(i({class:"racing-plus-settings",html:['<label for="rplus-apikey">API Key</label>',o,n({id:"rplus_addlinks",label:"Add profile links"}),n({id:"rplus_showskill",label:"Show racing skill"}),n({id:"rplus_showspeed",label:"Show current speed"}),n({id:"rplus_showracelink",label:"Add race link"}),n({id:"rplus_showexportlink",label:"Add export link"}),n({id:"rplus_showwinrate",label:"Show car win rate"}),n({id:"rplus_showparts",label:"Show available parts"})]})),t.appendChild(l),t.appendChild(i({class:"racing-plus-footer"})),r.insertAdjacentElement("beforeBegin",t),Logger.debug("Settings panel added.")},o=async()=>{Logger.debug("Adding settings panel toggle button..."),Logger.debug("Settings button added.")},l=async()=>{Logger.debug("Loading DOM..."),Logger.debug("Fixing top banner...");const r=await t(".banner"),a=e.document.createElement("div");a.className="left-banner";const i=e.document.createElement("div");i.className="right-banner";Array.from(r.children).forEach(e=>{e.classList.contains("skill-desc")||e.classList.contains("skill")||e.classList.contains("lastgain")?(e.classList.contains("skill")&&(this_driver.updateSkill(e.textContent),e.textContent=String(this_driver.skill)),a.appendChild(e)):(e.classList.contains("class-desc")||e.classList.contains("class-letter"))&&i.appendChild(e)}),r.innerHTML="",r.appendChild(a),r.appendChild(i),Logger.debug("DOM loaded.")};await(async()=>{try{Logger.info("Application loaded. Starting..."),await(async()=>{Logger.debug("Injecting styles...");const r=e.document.createElement("style");if(r.innerHTML='.d .racing-plus-footer::before,.d .racing-plus-header::after{position:absolute;display:block;content:"";height:0;width:100%;left:0}.d .racing-plus-panel{margin:10px 0;padding:0;display:none}.d .racing-plus-panel .show{display:block}.d .racing-plus-header{position:relative;padding-left:10px;height:30px;line-height:30px;font-size:12px;font-weight:700;letter-spacing:0;text-shadow:0 0 2px rgba(0,0,0,.5019607843);text-shadow:var(--tutorial-title-shadow);color:#fff;color:var(--tutorial-title-color);border:0!important;border-radius:5px 5px 0 0;background:linear-gradient(180deg,#888 0,#444 100%)}.d.dark-mode .racing-plus-header{background:linear-gradient(180deg,#555 0,#333 100%)}.d .racing-plus-header::after{bottom:-1px;border-top:1px solid #999;border-bottom:1px solid #ebebeb}.d.dark-mode .racing-plus-header::after{border-bottom:1px solid #222;border-top:1px solid #444}.d .racing-plus-footer{position:relative;margin:0;padding:0;height:10px;border:0!important;border-radius:0 0 5px 5px;background:linear-gradient(0deg,#888 0,#444 100%)}.d.dark-mode .racing-plus-footer{background:linear-gradient(0deg,#555 0,#333 100%)}.d .racing-plus-footer::before{top:-1px;border-bottom:1px solid #999;border-top:1px solid #ebebeb}.d.dark-mode .racing-plus-footer::before{border-top:1px solid #222;border-bottom:1px solid #444}.d .racing-plus-main{margin:0;padding:5px 10px;background-color:#f2f2f2}.d.dark-mode .racing-plus-main{background-color:#2e2e2e}.d .racing-plus-settings{display:grid;grid-template-columns:auto min-content;grid-template-rows:repeat(6,min-content);gap:0}.d .racing-plus-settings label{padding:6px 5px;font-size:.7rem;white-space:nowrap}.d .racing-plus-settings div{padding:0 5px;font-size:.7rem;text-align:right;position:relative}.d .racing-plus-settings div.flex-col{padding:0;margin-top:2px}.d .racing-plus-settings div,.d .racing-plus-settings label{border-bottom:2px groove #ebebeb}.d.dark-mode .racing-plus-settings div,.d.dark-mode .racing-plus-settings label{border-bottom:2px groove #444}.d .racing-plus-settings div:last-of-type,.d .racing-plus-settings label:last-of-type{border-bottom:0}.d .racing-plus-settings div input[type=checkbox]{height:12px;margin:5px 0;accent-color:#c00}#rplus-apikey{text-align:right;width:120px;height:12px;margin:0;padding:1px 2px;border-radius:3px;border:1px solid #767676;vertical-align:text-bottom}#rplus-apikey .valid{border-color:#090!important}#rplus-apikey .invalid{border-color:#c00!important}.d .flex-col{display:flex;flex-direction:column}.d .nowrap{white-space:nowrap!important}.d .racing-plus-apikey-actions{margin-right:10px}.d .racing-plus-apikey-status{color:red;padding:2px 5px;font-size:.6rem;display:none}.d .racing-plus-apikey-reset,.d .racing-plus-apikey-save{cursor:pointer;margin:0 0 2px;padding:0;height:16px;width:16px;display:none}.d .racing-plus-apikey-reset.show,.d .racing-plus-apikey-save.show,.d .racing-plus-apikey-status.show{display:inline-block!important}.d .racing-plus-apikey-reset svg path,.d .racing-plus-apikey-save svg path{fill:#666;fill:var(--top-links-icon-svg-fill);filter:drop-shadow(0 1px 0 rgba(255, 255, 255, .6509803922));filter:var(--top-links-icon-svg-shadow)}.d .racing-plus-apikey-reset:hover svg path,.d .racing-plus-apikey-save:hover svg path{fill:#444;fill:var(--top-links-icon-svg-hover-fill);filter:drop-shadow(0 1px 0 rgba(255, 255, 255, .6509803922));filter:var(--top-links-icon-svg-hover-shadow)}.d .racing-plus-parts-available{display:flex;flex-direction:row;gap:10px;font-style:italic;padding:10px;font-size:.7rem;background:url("/images/v2/racing/header/stripy_bg.png") #2e2e2e}.d .left-banner,.d .right-banner{height:57px;top:44px;z-index:9999;position:absolute;border-top:1px solid #424242;border-bottom:1px solid #424242;background:url("/images/v2/racing/header/stripy_bg.png")}.d .racing-plus-parts-available::after{position:absolute;left:0;bottom:-1px;content:"";display:block;height:0;width:100%;border-bottom:1px solid #222;border-top:1px solid #444}.d .racing-plus-link-wrap .export-link,.d .racing-plus-link-wrap .race-link{width:20px;float:right;filter:drop-shadow(0 0 1px rgba(17, 17, 17, .5803921569));height:20px}.d .pm-categories .link .icons .parts{position:absolute;bottom:5px;left:5px;color:#00bfff}.d .pm-categories .link .icons .parts.bought{color:#0c0}.d .racing-main-wrap .pm-items-wrap .part-wrap .l-delimiter,.d .racing-main-wrap .pm-items-wrap .part-wrap .r-delimiter,.d .racing-main-wrap .pm-items-wrap .pm-items>li .b-delimiter{height:0!important;width:0!important}.d .racing-main-wrap .pm-items-wrap .pm-items .active .properties-wrap>li .name,.d .racing-main-wrap .pm-items-wrap .pm-items .active .properties-wrap>li .progress-bar,.d .racing-main-wrap .pm-items-wrap .pm-items .bought .properties-wrap>li .name,.d .racing-main-wrap .pm-items-wrap .pm-items .bought .properties-wrap>li .progress-bar{background:unset!important}.d .racing-main-wrap .pm-items-wrap .pm-items .active,.d .racing-main-wrap .pm-items-wrap .pm-items .active .title{background:rgba(0,191,255,.07)}.d .racing-main-wrap .pm-items-wrap .pm-items .active .info{color:#00bfff}.d .racing-main-wrap .pm-items-wrap .pm-items .name .positive{color:#9c0}.d .racing-main-wrap .pm-items-wrap .pm-items .active .name .positive{color:#00a9f9}.d .racing-main-wrap .pm-items-wrap .pm-items .name .negative{color:#e54c19}.d .racing-main-wrap .pm-items-wrap .pm-items .active .name .negative{color:#ca9800}.d .racing-main-wrap .pm-items-wrap .pm-items .bought,.d .racing-main-wrap .pm-items-wrap .pm-items .bought .title{background:rgba(133,178,0,.07)}.d .racing-main-wrap .pm-items-wrap .pm-items .bought .desc{color:#85b200}.d .racing-plus-link-wrap{cursor:pointer;float:right}.d .racing-plus-link-wrap .race-link{margin:4px 5px 6px}.d .racing-plus-link-wrap .export-link:hover,.d .racing-plus-link-wrap .race-link:hover{filter:drop-shadow(1px 1px 1px rgba(17, 17, 17, .5803921569))}.d .racing-plus-link-wrap .export-link{margin:5px}.d .racing-main-wrap .car-selected-wrap #drivers-scrollbar{overflow:hidden!important;max-height:none!important}.d .racing-main-wrap .car-selected-wrap .driver-item>li.status-wrap .status{margin:5px!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item{font-size:.7rem!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.car{padding:0 5px}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name{width:unset!important;display:flex;align-items:center;flex-grow:1;border-right:0}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name a{flex-basis:fit-content;width:unset!important;height:20px;padding:0;margin:0;display:block;text-decoration:none}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name a:hover{text-decoration:underline}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span{display:block;flex-basis:fit-content;width:unset!important;height:20px;line-height:1.3rem;font-size:.7rem;padding:0 7px;margin:0;border-radius:3px;white-space:nowrap;color:#fff;background:rgba(0,0,0,.25)}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-1{background:rgba(116,232,0,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-2{background:rgba(255,38,38,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-3{background:rgba(255,201,38,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-4{background:rgba(0,217,217,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-5{background:rgba(0,128,255,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-6{background:rgba(153,51,255,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-7{background:rgba(255,38,255,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-8{background:rgba(85,85,85,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-9{background:rgba(242,141,141,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-10{background:rgba(225,201,25,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-11{background:rgba(160,207,23,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-12{background:rgba(24,217,217,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-13{background:rgba(111,175,238,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-14{background:rgba(176,114,239,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-15{background:rgba(240,128,240,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-16{background:rgba(97,97,97,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-17{background:rgba(178,0,0,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-18{background:rgba(204,153,0,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-19{background:rgba(78,155,0,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-20{background:rgba(0,157,157,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-21{background:rgba(0,0,183,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name span.color-22{background:rgba(140,0,140,.5019607843)!important}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name div.statistics{display:flex;flex-grow:1;list-style:none;align-items:center;justify-content:space-between;padding:0 10px;margin:0}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.time{display:none}.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name div.statistics div,.d .racing-main-wrap .car-selected-wrap .drivers-list .driver-item>li.name li.time{flex-basis:fit-content;line-height:22px;height:22px;width:unset!important;padding:0 5px;margin:0;border-radius:3px;white-space:nowrap;background-color:rgba(0,0,0,.25)}.d .left-banner{width:150px;left:0;border-right:1px solid #424242;border-top-right-radius:5px;border-bottom-right-radius:5px;box-shadow:5px 0 10px -2px rgba(0,0,0,.5),0 5px 10px -2px rgba(0,0,0,.5)}.d .racing-main-wrap .header-wrap .banner .skill-desc{width:130px!important;top:15px!important;left:8px!important;font-size:1rem!important}.d .racing-main-wrap .header-wrap .banner .skill{top:33px!important;left:10px!important;font-size:.8rem!important}.d .racing-main-wrap .header-wrap .banner .lastgain{top:33px;left:75px;color:#0f0;position:absolute;font-size:.6rem!important}.d .right-banner{width:115px;right:0;border-left:1px solid #424242;border-top-left-radius:5px;border-bottom-left-radius:5px;box-shadow:-5px 0 10px -2px rgba(0,0,0,.5),0 5px 10px -2px rgba(0,0,0,.5)}.d .racing-main-wrap .header-wrap .banner .class-desc{right:40px!important;top:23px!important;font-size:1rem!important}.d .racing-main-wrap .header-wrap .banner .class-letter{right:12px!important;top:22px!important;font-size:1.5rem!important}@media screen and (max-width:784px){.d .racing-main-wrap .header-wrap .banner .class-desc,.d .racing-main-wrap .header-wrap .banner .skill-desc{font-size:.8rem!important;top:10px!important}.d .racing-main-wrap .header-wrap .banner .skill{top:10px!important;left:125px!important}.d .racing-main-wrap .header-wrap .banner .lastgain{top:10px!important;left:190px}.d .racing-main-wrap .header-wrap .banner .class-letter{top:10px!important;font-size:1.25rem!important}.d .left-banner,.d .right-banner{top:0;background-image:none!important;border:none!important;box-shadow:none!important}}',"1"===Store.getValue(Store.keys.rplus_showparts)){const e=[];Object.entries(PART_CATEGORIES).forEach(([,r])=>{r.forEach((r,a)=>{e.push(`.d .racing-plus-parts-available span[data-part="${r}"]{color:${RACE_COLOURS[a]};}`,`.d .racing-main-wrap .pm-items-wrap .pm-items li[data-part="${r}"]:not(.bought):not(.active) .status{background-color:${RACE_COLOURS[a]};background-image:unset;}`,`.d .racing-main-wrap .pm-items-wrap .pm-items li[data-part="${r}"]:not(.bought):not(.active) .bg-wrap .title{background-color:${RACE_COLOURS[a]}40;}`)})}),r.innerHTML+=e.join("")}e.document.head.appendChild(r),Logger.debug("Styles injected.")})(),torn_api=new TornAPI(Store.getValue(Store.keys.rplus_apikey)),0==torn_api.key?.length&&a&&await torn_api.validate(r)&&Store.setValue(Store.keys.rplus_apikey,r),Logger.debug("Loading Driver Data...");try{let e=Store.getValue(Store.keys.rplus_driver);e||(e=await t("#torn-user").value),this_driver=new TornDriver(JSON.parse(e).id),this_driver.load()}catch(e){Logger.error(`Failed to load driver data. ${e}`)}const i=await t(SELECTORS.main_container),n=await Promise.allSettled([s(i),o(),l()]);if(!n.every(e=>"fulfilled"===e.status))return void n.filter(e=>"rejected"===e.status).forEach(e=>Logger.error(`${e.reason}`));await(async()=>{Logger.debug("Initializing settings panel...");const r=await t("#rplus-apikey"),i=await t(".racing-plus-apikey-save"),n=await t(".racing-plus-apikey-reset"),s=await t(".racing-plus-apikey-status"),o=torn_api.key??"";a?(r.value=o,r.disabled=!0,r.readOnly=!0,s.textContent="Edit in TornPDA settings.",s.classList.toggle("show",!0),i.classList.toggle("show",!1),n.classList.toggle("show",!1)):(o.length>0?(r.value=o,r.disabled=!0,r.readOnly=!0,s.textContent="",s.classList.toggle("show",!1),i.classList.toggle("show",!1),n.classList.toggle("show",!0)):(r.disabled=!1,r.readOnly=!1,s.textContent="",s.classList.toggle("show",!1),i.classList.toggle("show",!0),n.classList.toggle("show",!1)),i.addEventListener("click",async e=>{e.preventDefault();const a=r.value.trim();r.classList.remove("valid","invalid");try{await torn_api.validate(a)&&(Logger.debug("Valid API key."),r.classList.add("valid"),torn_api.saveKey(),r.disabled=!0,r.readOnly=!0,i.classList.toggle("show",!1),n?.classList.toggle("show",!0),s&&(s.textContent="",s.classList.toggle("show",!1)))}catch(e){return Logger.warn(e),r.classList.add("invalid"),s&&(s.textContent=e.message??e,s.classList.toggle("show",!0)),!1}}),n.addEventListener("click",e=>{e.preventDefault(),r&&(r.value="",r.disabled=!1,r.readOnly=!1,r.classList.remove("valid","invalid"),torn_api.deleteKey(),i?.classList.toggle("show",!0),n.classList.toggle("show",!1),s&&(s.textContent="",s.classList.toggle("show",!1)))})),e.document.querySelectorAll(".racing-plus-settings input[type=checkbox]").forEach(e=>{const r=Store.keys[e.id];r&&(e.checked="1"===Store.getValue(r),e.addEventListener("click",a=>{const t=a.currentTarget;Store.setValue(r,t.checked?"1":"0"),Logger.debug(`${e.id} saved ${t.checked?"on":"off"}.`)}))}),Logger.debug("Settings panel initialized.")})(torn_api.key),await this_driver.updateRecords(),await this_driver.updateCars(),Logger.info("Application started.")}catch(e){Logger.error(e)}})()})(window);